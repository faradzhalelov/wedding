rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Allow read access to all guests (anyone with link can see their invitation)
    match /guests/{guestId} {
      allow read: if true;
      
      // Allow updates to RSVP response fields
      // Check that only allowed fields are being modified
      allow update: if 
        request.resource.data.diff(resource.data).affectedKeys().hasOnly([
          'attending', 
          'guestsCount', 
          'responded', 
          'updatedAt'
        ]);
    }
  }
}
